{
  "pay_by_link": {
    "created_at": "2021-05-13T01:01:43-08:00",
    "currency": "EUR",
    "amount": 3000,
    "description": "Abonament na siłownię",
    "bank": "mbank"
  },
  "dp": {
    "created_at": "2021-05-14T08:27:09Z",
    "currency": "USD",
    "amount": 599,
    "description": "FastFood",
    "iban": "DE91100000000123456789"
  },
  "card": {
    "created_at": "2021-05-13T09:00:05+02:00",
    "currency": "PLN",
    "amount": 2450,
    "description": "REF123457",
    "cardholder_name": "John",
    "cardholder_surname": "Doe",
    "card_number": "2222222222222222"
  }
}


{
  "pay_by_link": [
    {
      "created_at": "2021-05-13T01:01:43-08:00",
      "currency": "EUR",
      "amount": 3000,
      "description": "Abonament na siłownię",
      "bank": "mbank"
    }
  ],
  "dp": [
    {
      "created_at": "2021-05-14T08:27:09Z",
      "currency": "USD",
      "amount": 599,
      "description": "FastFood",
      "iban": "DE91100000000123456789"
    }
  ],
  "card": [
    {
      "created_at": "2021-05-13T09:00:05+02:00",
      "currency": "PLN",
      "amount": 2450,
      "description": "REF123457",
      "cardholder_name": "John",
      "cardholder_surname": "Doe",
      "card_number": "2222222222222222"
    },
    {
      "created_at": "2021-05-14T18:32:26Z",
      "currency": "GBP",
      "amount": 1000,
      "description": "REF123456",
      "cardholder_name": "John",
      "cardholder_surname": "Doe",
      "card_number": "1111111111111111"
    }
  ]
}

{
  "pay_by_link": [
    {
      "customer_id": 1,
      "created_at": "2021-05-13T01:01:43-08:00",
      "currency": "EUR",
      "amount": 3000,
      "description": "Abonament na siłownię",
      "bank": "mbank"
    }
  ],
  "dp": [
    {
      "customer_id": 1,
      "created_at": "2021-05-14T08:27:09Z",
      "currency": "USD",
      "amount": 599,
      "description": "FastFood",
      "iban": "DE91100000000123456789"
    }
  ],
  "card": [
    {
      "customer_id": 1,
      "created_at": "2021-05-13T09:00:05+02:00",
      "currency": "PLN",
      "amount": 2450,
      "description": "REF123457",
      "cardholder_name": "John",
      "cardholder_surname": "Doe",
      "card_number": "2222222222222222"
    },
    {
      "customer_id": 1,
      "created_at": "2021-05-14T18:32:26Z",
      "currency": "GBP",
      "amount": 1000,
      "description": "REF123456",
      "cardholder_name": "John",
      "cardholder_surname": "Doe",
      "card_number": "1111111111111111"
    }
  ]
}

CREATE TABLE PayByLink (
    PayByLinkID INTEGER       PRIMARY KEY AUTOINCREMENT
                              NOT NULL,
    CustomerID  INTEGER       NOT NULL,
    CreatedAt   VARCHAR (30)  NOT NULL,
    Currency    VARCHAR (3)   NOT NULL,
    Amount      INTEGER       NOT NULL,
    Description TEXT,
    Bank        VARCHAR (255) NOT NULL
);


@app.on_event("startup")
async def startup():
    app.db_connection = sqlite3.connect("northwind.db")
    app.db_connection.text_factory = lambda b: b.decode(errors="ignore")  # northwind specific


@app.on_event("shutdown")
async def shutdown():
    app.db_connection.close()